var ut=Object.defineProperty;var st=h=>{throw TypeError(h)};var ft=(h,a,t)=>a in h?ut(h,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):h[a]=t;var c=(h,a,t)=>ft(h,typeof a!="symbol"?a+"":a,t),it=(h,a,t)=>a.has(h)||st("Cannot "+t);var p=(h,a,t)=>(it(h,a,"read from private field"),t?t.call(h):a.get(h)),m=(h,a,t)=>a.has(h)?st("Cannot add the same private member more than once"):a instanceof WeakSet?a.add(h):a.set(h,t),g=(h,a,t,s)=>(it(h,a,"write to private field"),s?s.call(h,t):a.set(h,t),t);(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const d of n.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&s(d)}).observe(document,{childList:!0,subtree:!0});function t(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=t(i);fetch(i.href,n)}})();const e="?",A="start",M="end",nt="tower",rt=(h,a)=>Math.sqrt(Math.pow(h.x-a.x,2)+Math.pow(h.y-a.y,2));var N;class q{constructor(){m(this,N);g(this,N,Math.floor(Math.random()*1e7))}get id(){return p(this,N)}}N=new WeakMap;var $;class D extends q{constructor({game:t,health:s,speed:i,damage:n,reward:d,type:r,path:o}){super();c(this,"game");c(this,"health");c(this,"maxHealth");c(this,"speed");m(this,$);c(this,"gridPosition");c(this,"nextPosition");c(this,"distance");c(this,"damage");c(this,"lastUpdateTime",Date.now());c(this,"direction");c(this,"reward");c(this,"debuffs",[]);c(this,"monsterSize");c(this,"type");c(this,"path");this.game=t,this.health=s,this.maxHealth=s,this.speed=i,g(this,$,i),this.distance=0,this.path=o,this.gridPosition=this.game.level.mapMatrix.getPathPosition(0,this.path),this.nextPosition=this.game.level.mapMatrix.getPathPosition(.5,this.path),this.direction=this.getDirection(this.nextPosition),this.damage=n,this.reward=d,this.monsterSize=this.game.squareSize/1.5,this.type=r}getDirection(t){return this.gridPosition?t.col>this.gridPosition.col?"right":t.col<this.gridPosition.col?"left":t.row>this.gridPosition.row?"down":t.row<this.gridPosition.row?"up":"none":"none"}addDebuff(t){this.debuffs.push({...t,duration:Date.now()+t.duration})}applyDebuffs(){const t=Date.now();let s=p(this,$);this.debuffs=this.debuffs.filter(l=>!(t>l.duration));const n=(t-this.lastUpdateTime)/this.game.gameSpeed,d=this.isPoisoned(),r=this.debuffs.filter(l=>l.type==="freeze").length;if(r>0&&(s=Math.max(s/(2*r),p(this,$)/4)),d){const l=this.maxHealth*.005,u=n*l;this.takeDamage(u,"poison"),s*=.75}this.speed=s;const o=this.debuffs.filter(l=>l.type==="burn");if(o.length>1){this.debuffs=this.debuffs.filter(S=>S.type!=="burn");const l=o.reduce((S,X)=>S.duration>X.duration?S:X),u=Math.floor(1.025*o.reduce((S,X)=>{var at;return S+(((at=X.data)==null?void 0:at.damage)??0)},0)),w={...l,data:{damage:u}};this.debuffs.push(w),this.takeDamage(n*u,"burn")}}update(){this.applyDebuffs();const t=Date.now(),i=(t-this.lastUpdateTime)/this.game.gameSpeed*this.speed,n=this.distance+i;Math.floor(n)>Math.floor(this.distance)&&(this.gridPosition=this.nextPosition,this.nextPosition=this.game.level.mapMatrix.getPathPosition(n,this.path)),this.nextPosition&&n%1>.5&&this.distance%1<=.5&&(this.direction=this.getDirection(this.nextPosition)),this.distance=n,this.lastUpdateTime=t}getCanvasPosition(){if(!this.gridPosition)return null;const{row:t,col:s}=this.gridPosition,i=this.distance%1,{squareSize:n}=this.game;let d=s*n,r=t*n;return this.direction==="up"?(d+=n/2-this.monsterSize/2,r+=n-i*n):this.direction==="down"?(d+=n/2-this.monsterSize/2,r+=i*n):this.direction==="left"?(d+=n-i*n,r+=n/2-this.monsterSize/2):this.direction==="right"?(d+=i*n,r+=n/2-this.monsterSize/2):this.direction==="none"&&(d+=n/2-this.monsterSize/2,r+=n/2-this.monsterSize/2),{x:d,y:r}}getCenter(){const t=this.getCanvasPosition();return t?{x:t.x+this.monsterSize/2,y:t.y+this.monsterSize/2}:{x:0,y:0}}render(){const t=this.getCanvasPosition();if(!t)return;const{ctx:s}=this.game,{x:i,y:n}=t,d=this.getSprite(),r=128,{row:o,numberOfFrames:l}=this.getWalkingAnimationRowAndNumberOfFrames(),w=Math.floor(this.distance*l)%l*r,S=o*r;s.save(),this.direction==="left"&&(s.translate(i+this.monsterSize/2,n),s.scale(-1,1),s.translate(-i-this.monsterSize/2,-n)),s.drawImage(d,w,S+5,r,r,i,n,this.monsterSize,this.monsterSize),s.restore(),s.save(),s.fillStyle="red",s.fillRect(i+10,n,this.monsterSize-20,5),s.fillStyle="green",s.fillRect(i+10,n,(this.monsterSize-20)*this.health/this.maxHealth,5),s.restore()}getSprite(){switch(this.type){case"skeleton":return this.isFrozen()?this.game.images["monsters/SkeletonFrozen"]:this.isPoisoned()?this.game.images["monsters/SkeletonPoisoned"]:this.game.images["monsters/Skeleton"];case"plant":return this.isFrozen()?this.game.images["monsters/PlantFrozen"]:this.isPoisoned()?this.game.images["monsters/PlantPoisoned"]:this.game.images["monsters/Plant"];case"orcWarrior":return this.isFrozen()?this.game.images["monsters/OrcWarriorFrozen"]:this.isPoisoned()?this.game.images["monsters/OrcWarriorPoisoned"]:this.game.images["monsters/OrcWarrior"];case"fireSpirit":return this.isFrozen()?this.game.images["monsters/FireSpiritFrozen"]:this.isPoisoned()?this.game.images["monsters/FireSpiritPoisoned"]:this.game.images["monsters/FireSpirit"];default:return console.error("Invalid monster type",this.type),this.game.images["monsters/Skeleton"]}}isFrozen(){return this.debuffs.some(t=>t.type==="freeze")}isPoisoned(){return this.debuffs.some(t=>t.type==="poison")}getWalkingAnimationRowAndNumberOfFrames(){switch(this.type){case"skeleton":return{row:1,numberOfFrames:8};case"plant":return{row:2,numberOfFrames:9};case"orcWarrior":return{row:9,numberOfFrames:7};case"fireSpirit":return{row:5,numberOfFrames:7};default:return console.error("Invalid monster type",this.type),{row:0,numberOfFrames:0}}}takeDamage(t,s){this.game.damageLog[s]||(this.game.damageLog[s]=0),this.game.damageLog[s]+=Math.min(t,this.health),this.game.damageLog.max=Math.max(this.game.damageLog.max,t),this.health-=t,this.health<0&&(this.health=0)}isAlive(){return this.health>0}}$=new WeakMap;class L extends q{constructor({game:t,speed:s,damage:i,target:n,position:d,splash:r,debuffs:o,tower:l}){super();c(this,"game");c(this,"speed");c(this,"damage");c(this,"target");c(this,"position");c(this,"lastMoveTime");c(this,"angle");c(this,"height",10);c(this,"width",10);c(this,"images",["arrow"]);c(this,"splash",null);c(this,"debuffs",null);c(this,"tower");this.game=t,this.speed=s,this.damage=i,this.target=n,this.position=d,this.angle=0,this.splash=r??null,this.debuffs=o??null,this.lastMoveTime=Date.now(),this.tower=l}impact(){var s;const t=this.target;t instanceof D&&(t.takeDamage(this.damage,this.tower.type),(s=this.debuffs)==null||s.forEach(i=>{t.addDebuff(i)})),this.splash&&this.game.level.monsters.forEach(i=>{var r;if(t instanceof D&&i.id===t.id)return;const n=i.getCenter();if(!n)return;rt(this.position,n)<=this.splash*this.game.squareSize&&(i.takeDamage(this.damage,this.tower.type),(r=this.debuffs)==null||r.forEach(o=>{i.addDebuff(o)}))}),this.game.projectiles=this.game.projectiles.filter(i=>i.id!==this.id)}getImage(){const t=this.images.length,s=Math.floor(Date.now()/this.game.gameSpeed%t),i=this.images[s];return this.game.images[i]}getTargetPosition(){return this.target instanceof D?this.target.getCenter():this.game.convertGridPositionToCoordinates(this.target)}update(){const t=Date.now(),s=t-this.lastMoveTime,i=s/this.game.gameSpeed;this.speed*=1+2*i;const n=s/this.game.gameSpeed*this.speed,d=this.getTargetPosition(),r=Math.sqrt(Math.pow(d.x-this.position.x,2)+Math.pow(d.y-this.position.y,2));if(n>r){this.position=d,this.lastMoveTime=t,this.impact();return}const o=Math.atan2(d.y-this.position.y,d.x-this.position.x),l=Math.cos(o)*n,u=Math.sin(o)*n;this.angle=o+Math.PI,this.position={x:this.position.x+l,y:this.position.y+u},this.lastMoveTime=t}render(){const{ctx:t}=this.game;t.save(),t.translate(this.position.x,this.position.y),t.rotate(this.angle);try{t.drawImage(this.getImage(),-this.width/2,-this.height/2,this.width,this.height)}catch(s){console.log(s),this.game.debug&&alert(`Error rendering projectile ${this.getImage().src}: ${s}`)}t.restore()}}class ot extends L{constructor(t){super(t);c(this,"height",10);c(this,"width",25)}}const pt=(h,a)=>{const t=Math.sqrt(Math.pow(h.col-a.col,2)+Math.pow(h.row-a.row,2));return Math.abs(t)},tt=h=>lt(h.type,h.level),lt=(h,a)=>Math.round(B[h]*Math.pow(1.5,a+1)),gt=h=>{let a=B[h.type];for(let t=1;t<h.level;t++)a+=lt(h.type,t);return Math.round(a/2)},x=(h,a,t)=>{if(t<1)throw new Error("Level must be 1 or greater");let s=C[h][a];if(a==="range")return["ice"].includes(h)?s:["support-range","support-damage"].includes(h)?Number(s)+t:Number(s)+Math.floor(t/3);if(h==="mage"&&t>=10&&a==="splash"&&(s=.5),h==="fire"&&t>=10&&a==="multiTarget"&&(s=!0),h==="cannon"&&t>=10&&a==="damage"&&(s=C.cannon.damage*50),h==="lightning"&&t>=10&&a==="damage"&&(s=C.lightning.damage*5),h==="ice"&&t>=10&&a==="attackSpeed"&&(s=C.ice.attackSpeed*5),h==="arrow"&&t>=10&&a==="attackSpeed"&&(s=C.arrow.attackSpeed*50),typeof s!="number"||t===1)return s??null;const i=wt(h,a,t),n=Math.max(s*i,s);return Number(n.toFixed(2))},wt=(h,a,t)=>{switch(a){case"damage":return["ice"].includes(h)?Math.round(Math.pow(1.05,t)):Math.round(Math.pow(1.5,t));case"attackSpeed":return["basic","arrow","ice","mage"].includes(h)?Math.pow(1.1,t-1):["fire","lightning","cannon"].includes(h)?Math.pow(1.05,t-1):1;case"splash":return["cannon"].includes(h)?Math.pow(1.1,t-1):["mage","fire"].includes(h)?Math.pow(1.05,t-1):1;default:return 1}};var I,U;class T extends q{constructor(t,s,i){super();c(this,"game");c(this,"gridPosition");c(this,"range",4);c(this,"damage",60);c(this,"baseDamage",60);c(this,"baseRange",4);c(this,"attackSpeed",.5);c(this,"projectileSpeed");c(this,"lastAttackTime",Date.now());c(this,"lastUpdate",Date.now());c(this,"placed",!1);c(this,"type","basic");c(this,"multiTarget",!1);c(this,"splash",null);c(this,"debuffs",null);m(this,I,[]);m(this,U,1);c(this,"Projectile",ot);this.type=i;const n=C[this.type];this.game=t,this.gridPosition=s,this.range=n.range,this.baseRange=n.range,this.damage=n.damage,this.baseDamage=n.damage,this.attackSpeed=n.attackSpeed,this.splash=n.splash,this.multiTarget=n.multiTarget,this.projectileSpeed=this.game.gameSpeed,n.debuff&&(this.debuffs=[{type:n.debuff,duration:(n.debuffDuration??1)*this.game.gameSpeed}])}getImage(){let t=[this.game.images[`tower-${this.type}`]];this.type==="lightning"?t=[this.game.images[`tower-${this.type}`],this.game.images[`tower-${this.type}-2`]]:this.type==="support-damage"&&(t=[this.game.images[`tower-${this.type}`],this.game.images[`tower-${this.type}-2`]]);const s=t.length,i=Math.floor(Date.now()/this.game.gameSpeed%s);return t[i]}getCanvasPosition(){const{squareSize:t}=this.game,{col:s,row:i}=this.gridPosition,n=s*t,d=i*t;return{x:n,y:d}}render(){const{squareSize:t}=this.game,{x:s,y:i}=this.getCanvasPosition(),n=this.getImage();try{this.game.ctx.drawImage(n,s,i,t,t)}catch(d){console.error(d),this.game.debug&&alert(`Error rendering tower ${n}: ${d}`)}if(this.level>1){const d=["#ff0000","#ff4000","#ff7f00","#ffbf00","#ffff00","#bfff00","#7fff00","#40ff00","#00ff00","#00ff40","#00ff7f","#00ffbf","#00ffff","#00bfff","#007fff","#0040ff","#0000ff","#4000ff","#7f00ff","#bf00ff","#ff00ff"],r=this.level>d.length+1;this.game.ctx.fillStyle=r?"#000":d[this.level-2],this.game.ctx.beginPath(),this.game.ctx.arc(s+t-10,i+10,8,0,2*Math.PI),this.game.ctx.fill(),this.game.ctx.fillStyle=r?"#FFF":"#000",this.game.ctx.font="10px Arial",this.game.ctx.textAlign="center",this.game.ctx.fillText(this.level.toString(),s+t-10,i+10)}}update(){this.attack()}monsterIsValidTarget(t){return!t.gridPosition||!t.isAlive()?!1:pt(this.gridPosition,t.gridPosition)<=this.range}getTargetInRange(){const{monsters:t}=this.game.level;return t.find(s=>this.monsterIsValidTarget(s))??void 0}getTargetsInRange(){const{monsters:t}=this.game.level;return t.filter(s=>this.monsterIsValidTarget(s))??[]}getTargets(){if(this.multiTarget)return this.getTargetsInRange();const t=this.getTargetInRange();return t?[t]:[]}canAttack(){const s=Date.now()-this.lastAttackTime,i=this.game.gameSpeed/this.attackSpeed;return s>i}getDamage(){return this.damage}attack(){const t=Date.now();if(this.canAttack()){const s=this.getTargets();if(s.length>0){const i=t-this.lastUpdate,n=Math.max(1,Math.floor(i/(this.game.gameSpeed/this.attackSpeed)));s.forEach(d=>{for(let r=0;r<n;r++)this.game.projectiles.push(new this.Projectile({game:this.game,target:d,position:this.game.convertGridPositionToCoordinates(this.gridPosition),damage:this.getDamage(),speed:this.projectileSpeed,debuffs:this.debuffs,splash:this.splash,tower:this}))}),this.lastAttackTime=t}}this.lastUpdate=t}onSell(){this.game.money+=gt(this)}addBuff(t){this.towerBuffs=[...this.towerBuffs,t]}removeBuff(t){this.towerBuffs=this.towerBuffs.filter(s=>s.type!==t.type&&s.origin!==t.origin)}get towerBuffs(){return p(this,I)}set towerBuffs(t){g(this,I,t);let s=1,i=1;p(this,I).forEach(n=>{n.type==="range"?s+=n.value:n.type==="damage"&&(i+=n.value)}),this.damage=this.baseDamage*i,this.range=this.baseRange*s}get level(){return p(this,U)}set level(t){g(this,U,t),this.baseDamage=Number(x(this.type,"damage",t)),this.baseRange=Number(x(this.type,"range",t)),this.attackSpeed=Number(x(this.type,"attackSpeed",t));const s=x(this.type,"splash",t);this.splash=typeof s=="number"?s:null,this.multiTarget=!!x(this.type,"multiTarget",t),this.towerBuffs=this.towerBuffs}}I=new WeakMap,U=new WeakMap;class xt extends T{constructor(t,s){super(t,s,"arrow");c(this,"Projectile",ot);this.projectileSpeed=this.game.gameSpeed}}class St extends L{constructor(t){super(t);c(this,"height",10);c(this,"width",25);c(this,"images",["bullet-1","bullet-2","bullet-3","bullet-4"])}}class vt extends T{constructor(t,s){super(t,s,"cannon");c(this,"Projectile",St);this.projectileSpeed=this.game.gameSpeed/2}}class yt extends L{constructor(){super(...arguments);c(this,"height",10);c(this,"width",25);c(this,"images",["fire-1","fire-2"])}impact(){Math.random()>.8&&(this.damage*=2,this.debuffs=[{type:"burn",duration:this.game.gameSpeed*4,data:{damage:this.damage/4}}]),super.impact()}}class bt extends T{constructor(t,s){super(t,s,"fire");c(this,"Projectile",yt);this.projectileSpeed=this.game.gameSpeed}}const Mt={freeze:"freeze",poison:"poison",burn:"burn"};class Tt extends L{constructor(){super(...arguments);c(this,"height",25);c(this,"width",25);c(this,"images",["frost-1","frost-2","frost-3","frost-4","frost-5","frost-6","frost-7","frost-8","frost-9","frost-10","frost-11","frost-12","frost-13"]);c(this,"debuffs",[{type:Mt.freeze,duration:this.game.gameSpeed*2}])}}class Pt extends T{constructor(t,s){super(t,s,"ice");c(this,"Projectile",Tt);this.projectileSpeed=this.game.gameSpeed}}class kt extends L{constructor(t){super(t);c(this,"height",15);c(this,"width",30);c(this,"previousTargets",[]);c(this,"images",["lightning-1","lightning-2"]);this.previousTargets.push(t.target.id)}impact(){super.impact(),this.game.level.monsters.find(t=>!(this.target instanceof D)||this.previousTargets.includes(t.id)?!1:rt(t.getCanvasPosition(),this.target.getCanvasPosition())<150?(this.previousTargets.push(t.id),this.target=t,this.damage*=.9,this.game.projectiles.push(this),!0):!1)}}class zt extends T{constructor(t,s){super(t,s,"lightning");c(this,"Projectile",kt);this.projectileSpeed=this.game.gameSpeed*4}getDamage(){let t=this.damage,s=1;this.towerBuffs.forEach(n=>{n.type==="damage"&&(s+=n.value)}),t*=s;const i=this.level<10?.9:.75;for(;Math.random()>i;)t*=10;return t}}class Ct extends L{constructor(){super(...arguments);c(this,"height",12);c(this,"width",20);c(this,"images",["crystal"])}}class Et extends T{constructor(t,s){super(t,s,"mage");c(this,"Projectile",Ct);this.projectileSpeed=this.game.gameSpeed*5}}class At extends L{constructor(){super(...arguments);c(this,"height",25);c(this,"width",25);c(this,"images",["poison-1","poison-2","poison-3","poison-4","poison-5","poison-6","poison-7","poison-8"])}}class qt extends T{constructor(t,s){super(t,s,"poison");c(this,"Projectile",At);this.projectileSpeed=this.game.gameSpeed/1.5}}class Lt extends T{constructor(){super(...arguments);c(this,"buffInterval",5e3);c(this,"lastBuffTime",Date.now()-this.buffInterval);c(this,"buffsToApply",[])}attack(){}update(){super.update(),Date.now()>this.lastBuffTime+this.buffInterval&&(this.buffTowers(),this.lastBuffTime=Date.now())}buffTowers(){this.getTowersInRange().forEach(s=>{this.buffsToApply.forEach(i=>{s.towerBuffs.some(n=>n.type===i.type&&n.origin===this.id)||s.addBuff(i)})})}onSell(){super.onSell(),this.removeBuffs()}removeBuffs(){this.getTowersInRange().forEach(s=>{this.buffsToApply.forEach(i=>{s.removeBuff(i)})})}getTowersInRange(){return this.game.level.towers.filter(t=>this.id===t.id?!1:pt(this.gridPosition,t.gridPosition)<=this.range+.5)}}class Dt extends Lt{constructor(t,s){super(t,s,"support-damage");c(this,"buffsToApply",[{origin:this.id,type:"damage",value:.5,stackable:!0}])}attack(){}}const ht=["basic","arrow","cannon","ice","poison","fire","lightning","mage","support-damage"],B={basic:50,arrow:100,cannon:200,fire:1e3,ice:450,mage:7500,lightning:2e3,poison:500,"support-damage":5e3},C={basic:{range:4,damage:60,attackSpeed:.5,splash:0,debuff:null,multiTarget:!1},arrow:{range:5,damage:50,attackSpeed:1,splash:0,debuff:null,multiTarget:!1},cannon:{range:5,damage:150,attackSpeed:.5,splash:1.5,debuff:null,multiTarget:!1},fire:{range:5,damage:500,attackSpeed:1,splash:.75,multiTarget:!1,debuff:null,special:"20% chance to crit. Critical hits deal double damage and applies a potentially infinitely scaling burn debuff"},ice:{range:5,damage:50,attackSpeed:1,splash:1,multiTarget:!1,debuff:"freeze",debuffDuration:2,special:"Slows enemies by 50%. Can stack two times."},mage:{range:10,damage:5e3,attackSpeed:3,splash:0,multiTarget:!1,debuff:null},lightning:{range:5,damage:250,attackSpeed:1,splash:0,debuff:null,multiTarget:!1,special:"Deals random damage. With a good deal of luck it can oneshot any monster. Lightning also chains to nearby enemies"},poison:{range:2,damage:0,attackSpeed:1,splash:0,multiTarget:!0,debuff:"poison",debuffDuration:10,special:"Poison deals 0.5% of the target's max health per second"},"support-damage":{range:2,damage:0,attackSpeed:0,splash:0,debuff:null,multiTarget:!1,special:"Increases damage of nearby towers by 50%"}},mt={basic:T,arrow:xt,cannon:vt,mage:Et,ice:Pt,fire:bt,lightning:zt,poison:qt,"support-damage":Dt};class Bt{constructor(a){c(this,"game");c(this,"mousePosition");this.game=a,this.mousePosition={x:0,y:0},this.init()}getCellAtMousePosition(){const{x:a,y:t}=this.mousePosition,{squareSize:s}=this.game,i=Math.floor(a/s);return{row:Math.floor(t/s),col:i}}init(){this.game.canvas.addEventListener("mousemove",a=>{const t=this.game.canvas.getBoundingClientRect();this.mousePosition={x:a.clientX-t.left,y:a.clientY-t.top},this.game.hoveredCell=this.getCellAtMousePosition()}),this.game.canvas.addEventListener("click",()=>{this.handleClick()}),this.game.canvas.addEventListener("contextmenu",a=>{this.handleContextMenu(a)})}handleClick(){var s;const a=this.getCellAtMousePosition();let t=!1;if((s=this.game.dialogs)==null||s.forEach(i=>{var n;(n=i.buttons)==null||n.forEach(d=>{t=t||d.handleClick(this.mousePosition)})}),!t)if(this.game.newTower&&this.game.level.mapMatrix.matrix[a.col][a.row]===e)this.game.money>=B[this.game.newTower]&&(this.game.level.mapMatrix.matrix[a.col][a.row]=nt,this.game.level.towers.push(new mt[this.game.newTower](this.game,a,"basic")),this.game.money-=B[this.game.newTower],this.game.money<B[this.game.newTower]&&(this.game.newTower=null));else if(this.game.newTower===null){const i=this.getTowerInCell(a);i?this.game.selectedTower=i:this.game.selectedTower=null}else this.game.newTower&&(this.game.newTower=null)}getTowerInCell(a){return this.game.level.towers.find(t=>t.gridPosition.col===a.col&&t.gridPosition.row===a.row)}handleContextMenu(a){a.preventDefault();const t=this.getCellAtMousePosition();if(this.game.newTower)this.game.newTower=null;else if(this.game.level.mapMatrix.matrix[t.col][t.row]===nt){const s=this.getTowerInCell(t);s&&(this.game.paused=!0,confirm(`Sell for ${gt(s)} coins?`)&&(this.game.level.towers=this.game.level.towers.filter(i=>i.id!==s.id),this.game.level.mapMatrix.matrix[t.col][t.row]=e,s.onSell()),this.game.paused=!1)}}}const $t=[[e,A,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e],[e,[{path:"0",distance:1}],e,[{path:"0",distance:67}],[{path:"0",distance:66}],[{path:"0",distance:65}],[{path:"0",distance:64}],[{path:"0",distance:63}],[{path:"0",distance:62}],[{path:"0",distance:61}],[{path:"0",distance:60}],[{path:"0",distance:59}],[{path:"0",distance:58}],[{path:"0",distance:57}],[{path:"0",distance:56}],[{path:"0",distance:55}],[{path:"0",distance:54}],[{path:"0",distance:53}],[{path:"0",distance:52}],e],[e,[{path:"0",distance:2}],e,[{path:"0",distance:68}],e,e,e,e,e,e,e,e,e,e,e,e,e,e,[{path:"0",distance:51}],e],[e,[{path:"0",distance:3}],e,[{path:"0",distance:69}],e,[{path:"0",distance:119}],[{path:"0",distance:118}],[{path:"0",distance:117}],[{path:"0",distance:116}],[{path:"0",distance:115}],[{path:"0",distance:114}],[{path:"0",distance:113}],[{path:"0",distance:112}],[{path:"0",distance:111}],[{path:"0",distance:110}],[{path:"0",distance:109}],[{path:"0",distance:108}],e,[{path:"0",distance:50}],e],[e,[{path:"0",distance:4}],e,[{path:"0",distance:70}],e,[{path:"0",distance:120}],e,e,e,e,e,e,e,e,e,e,[{path:"0",distance:107}],e,[{path:"0",distance:49}],e],[e,[{path:"0",distance:5}],e,[{path:"0",distance:71}],e,[{path:"0",distance:121}],e,[{path:"0",distance:155}],[{path:"0",distance:154}],[{path:"0",distance:153}],[{path:"0",distance:152}],[{path:"0",distance:151}],[{path:"0",distance:150}],[{path:"0",distance:149}],[{path:"0",distance:148}],e,[{path:"0",distance:106}],e,[{path:"0",distance:48}],e],[e,[{path:"0",distance:6}],e,[{path:"0",distance:72}],e,[{path:"0",distance:122}],e,[{path:"0",distance:156}],e,e,e,e,e,e,[{path:"0",distance:147}],e,[{path:"0",distance:105}],e,[{path:"0",distance:47}],e],[e,[{path:"0",distance:7}],e,[{path:"0",distance:73}],e,[{path:"0",distance:123}],e,[{path:"0",distance:157}],e,[{path:"0",distance:175}],[{path:"0",distance:174}],[{path:"0",distance:173}],[{path:"0",distance:172}],e,[{path:"0",distance:146}],e,[{path:"0",distance:104}],e,[{path:"0",distance:46}],e],[e,[{path:"0",distance:8}],e,[{path:"0",distance:74}],e,[{path:"0",distance:124}],e,[{path:"0",distance:158}],e,[{path:"0",distance:176}],M,[{path:"0",distance:182}],[{path:"0",distance:171}],e,[{path:"0",distance:145}],e,[{path:"0",distance:103}],e,[{path:"0",distance:45}],e],[e,[{path:"0",distance:9}],e,[{path:"0",distance:75}],e,[{path:"0",distance:125}],e,[{path:"0",distance:159}],e,[{path:"0",distance:177}],[{path:"0",distance:180}],[{path:"0",distance:181}],[{path:"0",distance:170}],e,[{path:"0",distance:144}],e,[{path:"0",distance:102}],e,[{path:"0",distance:44}],e],[e,[{path:"0",distance:10}],e,[{path:"0",distance:76}],e,[{path:"0",distance:126}],e,[{path:"0",distance:160}],e,[{path:"0",distance:178}],[{path:"0",distance:179}],e,[{path:"0",distance:169}],e,[{path:"0",distance:143}],e,[{path:"0",distance:101}],e,[{path:"0",distance:43}],e],[e,[{path:"0",distance:11}],e,[{path:"0",distance:77}],e,[{path:"0",distance:127}],e,[{path:"0",distance:161}],e,e,e,e,[{path:"0",distance:168}],e,[{path:"0",distance:142}],e,[{path:"0",distance:100}],e,[{path:"0",distance:42}],e],[e,[{path:"0",distance:12}],e,[{path:"0",distance:78}],e,[{path:"0",distance:128}],e,[{path:"0",distance:162}],[{path:"0",distance:163}],[{path:"0",distance:164}],[{path:"0",distance:165}],[{path:"0",distance:166}],[{path:"0",distance:167}],e,[{path:"0",distance:141}],e,[{path:"0",distance:99}],e,[{path:"0",distance:41}],e],[e,[{path:"0",distance:13}],e,[{path:"0",distance:79}],e,[{path:"0",distance:129}],e,e,e,e,e,e,e,e,[{path:"0",distance:140}],e,[{path:"0",distance:98}],e,[{path:"0",distance:40}],e],[e,[{path:"0",distance:14}],e,[{path:"0",distance:80}],e,[{path:"0",distance:130}],[{path:"0",distance:131}],[{path:"0",distance:132}],[{path:"0",distance:133}],[{path:"0",distance:134}],[{path:"0",distance:135}],[{path:"0",distance:136}],[{path:"0",distance:137}],[{path:"0",distance:138}],[{path:"0",distance:139}],e,[{path:"0",distance:97}],e,[{path:"0",distance:39}],e],[e,[{path:"0",distance:15}],e,[{path:"0",distance:81}],e,e,e,e,e,e,e,e,e,e,e,e,[{path:"0",distance:96}],e,[{path:"0",distance:38}],e],[e,[{path:"0",distance:16}],e,[{path:"0",distance:82}],[{path:"0",distance:83}],[{path:"0",distance:84}],[{path:"0",distance:85}],[{path:"0",distance:86}],[{path:"0",distance:87}],[{path:"0",distance:88}],[{path:"0",distance:89}],[{path:"0",distance:90}],[{path:"0",distance:91}],[{path:"0",distance:92}],[{path:"0",distance:93}],[{path:"0",distance:94}],[{path:"0",distance:95}],e,[{path:"0",distance:37}],e],[e,[{path:"0",distance:17}],e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,[{path:"0",distance:36}],e],[e,[{path:"0",distance:18}],[{path:"0",distance:19}],[{path:"0",distance:20}],[{path:"0",distance:21}],[{path:"0",distance:22}],[{path:"0",distance:23}],[{path:"0",distance:24}],[{path:"0",distance:25}],[{path:"0",distance:26}],[{path:"0",distance:27}],[{path:"0",distance:28}],[{path:"0",distance:29}],[{path:"0",distance:30}],[{path:"0",distance:31}],[{path:"0",distance:32}],[{path:"0",distance:33}],[{path:"0",distance:34}],[{path:"0",distance:35}],e],[e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e]],It=h=>{const a=document.createElement("div");a.id="toolbar-top";const t=document.createElement("button");t.id="start-wave",t.innerHTML="Start Wave",t.addEventListener("click",()=>{h.startWave()}),a.innerHTML=`
    <div class="toolbar-item">
      <span>🪙: </span>
      <span id="money" class="money">${h.money.toLocaleString("en-US")}</span>
    </div>
    <div class="toolbar-item">
      <span>❤️: </span>
      <span id="health">${h.health}</span>
    </div>
    <div class="toolbar-item">
      <span>🌊: </span>
      <span id="wave">0</span>
    </div>
    <div class="toolbar-item">
      <span>👿: </span>
      <span id="monsters">0</span>
    </div>
     <div class="toolbar-item">
      <span>💀: </span>
      <span id="kills">0</span>
    </div>
  `,a.appendChild(t);const s=document.createElement("label");s.innerHTML=`
    <input type="checkbox" id="automode" />
    <span>Auto mode</span>
  `,a.appendChild(s);const i=document.createElement("span");i.innerHTML="Speed: ",a.appendChild(i),[.25,.5,1,2,5].forEach(o=>{const l=document.createElement("button");l.innerHTML=`x${o}`,l.addEventListener("click",()=>{h.gameSpeed=1e3/o}),a.appendChild(l)}),document.body.insertBefore(a,document.body.firstChild);const n=document.createElement("div");n.id="toolbar-bottom",ht.forEach(o=>{const l=document.createElement("button");l.innerHTML=`
    <img src="assets/tower-${o}.png" alt="${o} tower" />
    <span>${o} tower - <span class="price">${B[o].toLocaleString("en-US")}🪙</span></span>
    `,l.addEventListener("click",()=>{h.newTower=o,h.selectedTower=null}),n.appendChild(l)}),document.body.appendChild(n);const d=document.createElement("div");d.id="info-panel",d.innerHTML=`
  <details>
  <summary>How to play</summary>
  <h2>Goal</h2>
  <p>Defend your base from waves of monsters by building towers. The monsters move from the blue square(s) to the red square(s)</p>
  <h2>Adding towers</h2>
  <p>
    Use the toolbar at the bottom to select a tower type. Click on an empty square on the map to add a tower.
  </p>
  <h2>Selling towers</h2>
  <p>
    Right-click on a tower to sell it for half the price.
  </p>
  <h2>Starting a wave</h2>
  <p>
    Click the "Start Wave" button to start a new wave of monsters.
  </p>
  <h2>Auto mode</h2>
  <p>
    When auto mode is enabled, the game will automatically start new waves when the previous wave is defeated.
  </p>
  
  </details>
  
  `,document.body.appendChild(d);const r=document.createElement("div");r.id="tower-table",r.innerHTML=`
  <details>
  <summary>Tower Stats</summary>
  <h2>Towers:</h2>
  <i>Speed is number of attacks per second. Range and splash values are in number of squares. 
  </i>
  <table>
  <thead>
  
  <tr>
    <th>Type</th>
    <th>Damage</th>
    <th>Speed</th>
    <th>DPS</th>
    <th>Range</th>
    <th>Splash</th>
    <th>Multi target</th>
    <th>Debuff</th>
    <th>Special</th>
  </tr>
  </thead>
  <tbody>
  ${ht.map(o=>{const l=C[o];return`<tr>
      <td><img src="assets/tower-${o}.png" alt="${o} tower" /></td>
      <td>${l.damage}</td>
      <td>${l.attackSpeed}</td>
      <td>${l.damage*l.attackSpeed}</td>
      <td>${l.range}</td>
      <td>${l.splash||"❌"}</td>
      <td>${l.multiTarget?"✅":"❌"}</td>
      <td>${l.debuff?`${l.debuff} (${l.debuffDuration}s)`:"❌"}</td>
      <td>${l.special??""}</td>
      </tr>`}).join("")}
  </tbody>
  </table>
  </details>
  `,document.body.appendChild(r)},Rt=h=>{const a=document.getElementById("health");a&&(a.innerText=h.toLocaleString("en-US"))},jt=h=>{const a=document.getElementById("kills");a&&(a.innerText=h.toLocaleString("en-US"))},Ft=h=>{const a=document.getElementById("money");a&&(a.innerText=h.toLocaleString("en-US"))},ct=h=>{const a=document.getElementById("monsters");a&&(a.innerText=h.toLocaleString("en-US"))};class Ot extends D{constructor({game:a,...t}){super({game:a,...t}),this.monsterSize=this.game.squareSize}}const Wt=h=>{const a=document.getElementById("wave");a&&(a.innerText=h.toLocaleString("en-US"))};class Ht extends q{constructor(t,s){super();c(this,"matrix");c(this,"level");c(this,"totalDistances",{});c(this,"distanceToPositionMap",{});this.level=t,this.matrix={},s?(this.matrix=s,Object.values(s).forEach(i=>{Object.values(i).forEach(n=>{Array.isArray(n)&&n.forEach(d=>{this.totalDistances[d.path]=Math.max(d.distance||0,this.totalDistances[d.path]||0)})})})):this.generateMapMatrix()}initMatrix(){var i,n;const{gridWidth:t,gridHeight:s}=this.level.game;this.matrix=Array.from({length:t},()=>Array(s).fill(e)),(i=this.level.startPositions)==null||i.forEach((d,r)=>{this.matrix[d.col][d.row]=[{path:`${r}`,distance:0}]}),(n=this.level.endPositions)==null||n.forEach(d=>{this.matrix[d.col][d.row]=M})}generateMapMatrix(){var t;(t=this.level.startPositions)==null||t.forEach((s,i)=>{var d;let n=0;do this.initMatrix(),(d=this.level.startPositions)==null||d.forEach((r,o)=>{this.totalDistances[o]=this.buildPath(r.col,r.row,1,`${o}`)}),n++;while((Object.keys(this.totalDistances).some(r=>this.totalDistances[r]<this.level.minLength)||Object.keys(this.totalDistances).some(r=>this.totalDistances[r]>this.level.maxLength))&&n<100);n>=100&&console.log("Failed to generate path")})}buildPath(t,s,i,n){const d=this.getNeighbors(t,s);if(d.some(({row:u,col:w})=>this.getCell(w,u)===M))return i;const r=d.filter(({col:u,row:w})=>this.canBePath(u,w,i,n));if(r.length===0)return-1;const o=r[Math.floor(Math.random()*r.length)],l=this.matrix[o.col][o.row];return Array.isArray(l)?l.push({path:n,distance:i}):this.matrix[o.col][o.row]=[{path:n,distance:i}],this.buildPath(o.col,o.row,i+1,n)}getNeighbors(t,s){const i=[];return t>0&&i.push({col:t-1,row:s}),t<this.level.game.gridWidth-1&&i.push({col:t+1,row:s}),s>0&&i.push({col:t,row:s-1}),s<this.level.game.gridHeight-1&&i.push({col:t,row:s+1}),i}getCell(t,s){return this.matrix[t][s]}canBePath(t,s,i,n){const d=this.getCell(t,s);return!(d!==e&&Array.isArray(d)===!1||Array.isArray(d)&&d.some(o=>o.path===n&&o.distance>i-10)||this.getNeighbors(t,s).filter(({col:o,row:l})=>{const u=this.getCell(o,l);return Array.isArray(u)?!!(Array.isArray(u)&&u.some(w=>w.path===n&&w.distance>i-10)):!1}).length>1||Array.isArray(d)&&d.length>=this.level.maxRepeatSquares)}getPathPosition(t,s){const i=Math.ceil(t),n=`${s}${i}`;if(this.distanceToPositionMap[n])return this.distanceToPositionMap[n];let d=i<=0?this.level.startPositions[Math.floor(Math.random()*this.level.startPositions.length)]:this.level.endPositions[0];return Object.keys(this.matrix).forEach(r=>{const o=Number(r);Object.keys(this.matrix[o]).forEach(l=>{const u=Number(l),w=this.matrix[o][u];if(Array.isArray(w)&&w.find(S=>S.distance===i&&S.path===s)){d={row:u,col:o};return}})}),this.distanceToPositionMap[n]=d,d}}var R;class J extends q{constructor({game:t,startPositions:s,endPositions:i,minLength:n,maxLength:d,maxRepeatSquares:r,map:o}){super();c(this,"game");c(this,"startPositions");c(this,"endPositions");c(this,"mapMatrix");c(this,"minLength");c(this,"maxLength");c(this,"maxRepeatSquares");c(this,"towers",[]);c(this,"monsters",[]);m(this,R,0);this.game=t,this.startPositions=s,this.endPositions=i,this.minLength=n,this.maxLength=d,this.maxRepeatSquares=r,this.mapMatrix=new Ht(this,o)}get wave(){return p(this,R)}set wave(t){g(this,R,t),Wt(p(this,R))}}R=new WeakMap;const Nt=["tower-basic","tower-arrow","tower-cannon","tower-mage","tower-ice","tower-fire","tower-lightning","tower-lightning-2","tower-support-damage","tower-support-damage-2","tower-support-range","tower-poison","arrow","bullet-1","bullet-2","bullet-3","bullet-4","fire-1","fire-2","frost-1","frost-2","frost-3","frost-4","frost-5","frost-6","frost-7","frost-8","frost-9","frost-10","frost-11","frost-12","frost-13","crystal","poison-1","poison-2","poison-3","poison-4","poison-5","poison-6","poison-7","poison-8","lightning-1","lightning-2","monsters/Skeleton","monsters/FireSpirit","monsters/OrcWarrior","monsters/Plant","monsters/SkeletonFrozen","monsters/FireSpiritFrozen","monsters/OrcWarriorFrozen","monsters/PlantFrozen","monsters/SkeletonPoisoned","monsters/FireSpiritPoisoned","monsters/OrcWarriorPoisoned","monsters/PlantPoisoned"],dt=["plant","skeleton","orcWarrior","fireSpirit"],Ut=[["?","?","?","?","?","?","?","?",[{distance:0,path:"0"}],"?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?"],["?","?","?","?","?","?","?","?",[{distance:1,path:"0"}],"?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?"],["?","?",[{distance:20,path:"0"},{distance:131,path:"1"},{distance:94,path:"2"},{distance:57,path:"3"}],[{distance:21,path:"0"},{distance:132,path:"1"},{distance:95,path:"2"},{distance:58,path:"3"}],[{distance:22,path:"0"},{distance:133,path:"1"},{distance:96,path:"2"},{distance:59,path:"3"}],[{distance:23,path:"0"},{distance:134,path:"1"},{distance:97,path:"2"},{distance:60,path:"3"}],[{distance:24,path:"0"},{distance:135,path:"1"},{distance:98,path:"2"},{distance:61,path:"3"}],[{distance:25,path:"0"},{distance:136,path:"1"},{distance:99,path:"2"},{distance:62,path:"3"}],[{distance:2,path:"0"},{distance:26,path:"0"},{distance:137,path:"1"},{distance:100,path:"2"},{distance:63,path:"3"}],"?","?","?","?","?","?","?","?","?","?","?","?",[{distance:125,path:"0"},{distance:88,path:"1"},{distance:51,path:"2"},{distance:14,path:"3"}],[{distance:126,path:"0"},{distance:89,path:"1"},{distance:52,path:"2"},{distance:15,path:"3"}],[{distance:127,path:"0"},{distance:90,path:"1"},{distance:53,path:"2"},{distance:16,path:"3"}],[{distance:128,path:"0"},{distance:91,path:"1"},{distance:54,path:"2"},{distance:17,path:"3"}],[{distance:129,path:"0"},{distance:92,path:"1"},{distance:55,path:"2"},{distance:18,path:"3"}],[{distance:130,path:"0"},{distance:93,path:"1"},{distance:56,path:"2"},{distance:19,path:"3"}],[{distance:131,path:"0"},{distance:94,path:"1"},{distance:57,path:"2"},{distance:20,path:"3"}],"?","?"],["?","?",[{distance:19,path:"0"},{distance:130,path:"1"},{distance:93,path:"2"},{distance:56,path:"3"}],"?","?","?","?","?",[{distance:3,path:"0"},{distance:27,path:"0"},{distance:138,path:"1"},{distance:101,path:"2"},{distance:64,path:"3"}],"?","?","?","?","?","?","?","?","?","?","?","?",[{distance:124,path:"0"},{distance:87,path:"1"},{distance:50,path:"2"},{distance:13,path:"3"}],"?","?","?","?","?",[{distance:132,path:"0"},{distance:95,path:"1"},{distance:58,path:"2"},{distance:21,path:"3"}],"?","?"],["?","?",[{distance:18,path:"0"},{distance:129,path:"1"},{distance:92,path:"2"},{distance:55,path:"3"}],"?","?","?","?","?",[{distance:4,path:"0"},{distance:28,path:"0"},{distance:139,path:"1"},{distance:102,path:"2"},{distance:65,path:"3"}],"?","?","?","?","?","?","?","?","?","?","?","?",[{distance:123,path:"0"},{distance:86,path:"1"},{distance:49,path:"2"},{distance:12,path:"3"}],"?","?","?","?","?",[{distance:133,path:"0"},{distance:96,path:"1"},{distance:59,path:"2"},{distance:22,path:"3"}],"?","?"],["?","?",[{distance:17,path:"0"},{distance:128,path:"1"},{distance:91,path:"2"},{distance:54,path:"3"}],"?","?","?","?","?",[{distance:5,path:"0"},{distance:29,path:"0"},{distance:140,path:"1"},{distance:103,path:"2"},{distance:66,path:"3"}],"?","?","?","?","?","?","?","?","?","?","?","?",[{distance:122,path:"0"},{distance:85,path:"1"},{distance:48,path:"2"},{distance:11,path:"3"}],"?","?","?","?","?",[{distance:134,path:"0"},{distance:97,path:"1"},{distance:60,path:"2"},{distance:23,path:"3"}],"?","?"],["?","?",[{distance:16,path:"0"},{distance:127,path:"1"},{distance:90,path:"2"},{distance:53,path:"3"}],"?","?","?","?","?",[{distance:6,path:"0"},{distance:30,path:"0"},{distance:141,path:"1"},{distance:104,path:"2"},{distance:67,path:"3"}],"?","?","?","?","?","?","?","?","?","?","?","?",[{distance:121,path:"0"},{distance:84,path:"1"},{distance:47,path:"2"},{distance:10,path:"3"}],"?","?","?","?","?",[{distance:135,path:"0"},{distance:98,path:"1"},{distance:61,path:"2"},{distance:24,path:"3"}],"?","?"],["?","?",[{distance:15,path:"0"},{distance:126,path:"1"},{distance:89,path:"2"},{distance:52,path:"3"}],"?","?","?","?","?",[{distance:7,path:"0"},{distance:31,path:"0"},{distance:142,path:"1"},{distance:105,path:"2"},{distance:68,path:"3"}],"?","?","?","?","?","?","?","?","?","?","?","?",[{distance:120,path:"0"},{distance:83,path:"1"},{distance:46,path:"2"},{distance:9,path:"3"}],"?","?","?","?","?",[{distance:136,path:"0"},{distance:99,path:"1"},{distance:62,path:"2"},{distance:25,path:"3"}],"?","?"],["?","?",[{distance:14,path:"0"},{distance:125,path:"1"},{distance:88,path:"2"},{distance:51,path:"3"}],[{distance:13,path:"0"},{distance:124,path:"1"},{distance:87,path:"2"},{distance:50,path:"3"}],[{distance:12,path:"0"},{distance:123,path:"1"},{distance:86,path:"2"},{distance:49,path:"3"}],[{distance:11,path:"0"},{distance:122,path:"1"},{distance:85,path:"2"},{distance:48,path:"3"}],[{distance:10,path:"0"},{distance:121,path:"1"},{distance:84,path:"2"},{distance:47,path:"3"}],[{distance:9,path:"0"},{distance:120,path:"1"},{distance:83,path:"2"},{distance:46,path:"3"}],[{distance:8,path:"0"},{distance:32,path:"0"},{distance:119,path:"1"},{distance:143,path:"1"},{distance:82,path:"2"},{distance:106,path:"2"},{distance:45,path:"3"},{distance:69,path:"3"}],[{distance:118,path:"1"},{distance:81,path:"2"},{distance:44,path:"3"}],[{distance:117,path:"1"},{distance:80,path:"2"},{distance:43,path:"3"}],[{distance:116,path:"1"},{distance:79,path:"2"},{distance:42,path:"3"}],[{distance:115,path:"1"},{distance:78,path:"2"},{distance:41,path:"3"}],[{distance:114,path:"1"},{distance:77,path:"2"},{distance:40,path:"3"}],[{distance:113,path:"1"},{distance:76,path:"2"},{distance:39,path:"3"}],[{distance:149,path:"0"},{distance:112,path:"1"},{distance:75,path:"2"},{distance:38,path:"3"}],[{distance:148,path:"0"},{distance:111,path:"1"},{distance:74,path:"2"},{distance:37,path:"3"}],[{distance:147,path:"0"},{distance:110,path:"1"},{distance:73,path:"2"},{distance:36,path:"3"}],[{distance:146,path:"0"},{distance:109,path:"1"},{distance:72,path:"2"},{distance:35,path:"3"}],[{distance:145,path:"0"},{distance:108,path:"1"},{distance:71,path:"2"},{distance:34,path:"3"}],[{distance:144,path:"0"},{distance:107,path:"1"},{distance:70,path:"2"},{distance:33,path:"3"}],[{distance:119,path:"0"},{distance:143,path:"0"},{distance:82,path:"1"},{distance:106,path:"1"},{distance:45,path:"2"},{distance:69,path:"2"},{distance:8,path:"3"},{distance:32,path:"3"}],[{distance:142,path:"0"},{distance:105,path:"1"},{distance:68,path:"2"},{distance:7,path:"3"},{distance:31,path:"3"}],[{distance:141,path:"0"},{distance:104,path:"1"},{distance:67,path:"2"},{distance:6,path:"3"},{distance:30,path:"3"}],[{distance:140,path:"0"},{distance:103,path:"1"},{distance:66,path:"2"},{distance:5,path:"3"},{distance:29,path:"3"}],[{distance:139,path:"0"},{distance:102,path:"1"},{distance:65,path:"2"},{distance:4,path:"3"},{distance:28,path:"3"}],[{distance:138,path:"0"},{distance:101,path:"1"},{distance:64,path:"2"},{distance:3,path:"3"},{distance:27,path:"3"}],[{distance:137,path:"0"},{distance:100,path:"1"},{distance:63,path:"2"},{distance:2,path:"3"},{distance:26,path:"3"}],[{distance:1,path:"3"}],[{distance:0,path:"3"}]],["?","?","?","?","?","?","?","?",[{distance:33,path:"0"},{distance:144,path:"1"},{distance:107,path:"2"},{distance:70,path:"3"}],"?","?","?","?","?","?",[{distance:150,path:"0"}],"?","?","?","?","?",[{distance:118,path:"0"},{distance:81,path:"1"},{distance:44,path:"2"}],"?","?","?","?","?","?","?","?"],["?","?","?","?","?","?","?","?",[{distance:34,path:"0"},{distance:145,path:"1"},{distance:108,path:"2"},{distance:71,path:"3"}],"?","?","?","?","?","?",[{distance:151,path:"0"}],"?","?","?","?","?",[{distance:117,path:"0"},{distance:80,path:"1"},{distance:43,path:"2"}],"?","?","?","?","?","?","?","?"],["?","?","?","?","?","?","?","?",[{distance:35,path:"0"},{distance:146,path:"1"},{distance:109,path:"2"},{distance:72,path:"3"}],"?","?","?","?","?","?",[{distance:152,path:"0"}],"?","?","?","?","?",[{distance:116,path:"0"},{distance:79,path:"1"},{distance:42,path:"2"}],"?","?","?","?","?","?","?","?"],["?","?","?","?","?","?","?","?",[{distance:36,path:"0"},{distance:147,path:"1"},{distance:110,path:"2"},{distance:73,path:"3"}],"?","?","?","?","?","?",[{distance:153,path:"0"}],"?","?","?","?","?",[{distance:115,path:"0"},{distance:78,path:"1"},{distance:41,path:"2"}],"?","?","?","?","?","?","?","?"],["?","?","?","?","?","?","?","?",[{distance:37,path:"0"},{distance:148,path:"1"},{distance:111,path:"2"},{distance:74,path:"3"}],"?","?","?","?","?","?",[{distance:154,path:"0"}],"?","?","?","?","?",[{distance:114,path:"0"},{distance:77,path:"1"},{distance:40,path:"2"}],"?","?","?","?","?","?","?","?"],["?","?","?","?","?","?","?","?",[{distance:38,path:"0"},{distance:149,path:"1"},{distance:112,path:"2"},{distance:75,path:"3"}],[{distance:150,path:"1"}],[{distance:151,path:"1"}],[{distance:152,path:"1"}],[{distance:153,path:"1"}],[{distance:154,path:"1"}],[{distance:155,path:"1"}],"?",[{distance:155,path:"3"}],[{distance:154,path:"3"}],[{distance:153,path:"3"}],[{distance:152,path:"3"}],[{distance:151,path:"3"}],[{distance:113,path:"0"},{distance:76,path:"1"},{distance:39,path:"2"},{distance:150,path:"3"}],"?","?","?","?","?","?","?","?"],["?","?","?","?","?","?","?","?",[{distance:39,path:"0"},{distance:113,path:"2"},{distance:76,path:"3"}],"?","?","?","?","?","?",[{distance:156,path:"2"}],"?","?","?","?","?",[{distance:112,path:"0"},{distance:75,path:"1"},{distance:38,path:"2"},{distance:149,path:"3"}],"?","?","?","?","?","?","?","?"],["?","?","?","?","?","?","?","?",[{distance:40,path:"0"},{distance:114,path:"2"},{distance:77,path:"3"}],"?","?","?","?","?","?",[{distance:155,path:"2"}],"?","?","?","?","?",[{distance:111,path:"0"},{distance:74,path:"1"},{distance:37,path:"2"},{distance:148,path:"3"}],"?","?","?","?","?","?","?","?"],["?","?","?","?","?","?","?","?",[{distance:41,path:"0"},{distance:115,path:"2"},{distance:78,path:"3"}],"?","?","?","?","?","?",[{distance:154,path:"2"}],"?","?","?","?","?",[{distance:110,path:"0"},{distance:73,path:"1"},{distance:36,path:"2"},{distance:147,path:"3"}],"?","?","?","?","?","?","?","?"],["?","?","?","?","?","?","?","?",[{distance:42,path:"0"},{distance:116,path:"2"},{distance:79,path:"3"}],"?","?","?","?","?","?",[{distance:153,path:"2"}],"?","?","?","?","?",[{distance:109,path:"0"},{distance:72,path:"1"},{distance:35,path:"2"},{distance:146,path:"3"}],"?","?","?","?","?","?","?","?"],["?","?","?","?","?","?","?","?",[{distance:43,path:"0"},{distance:117,path:"2"},{distance:80,path:"3"}],"?","?","?","?","?","?",[{distance:152,path:"2"}],"?","?","?","?","?",[{distance:108,path:"0"},{distance:71,path:"1"},{distance:34,path:"2"},{distance:145,path:"3"}],"?","?","?","?","?","?","?","?"],["?","?","?","?","?","?","?","?",[{distance:44,path:"0"},{distance:118,path:"2"},{distance:81,path:"3"}],"?","?","?","?","?","?",[{distance:151,path:"2"}],"?","?","?","?","?",[{distance:107,path:"0"},{distance:70,path:"1"},{distance:33,path:"2"},{distance:144,path:"3"}],"?","?","?","?","?","?","?","?"],[[{distance:0,path:"1"}],[{distance:1,path:"1"}],[{distance:63,path:"0"},{distance:2,path:"1"},{distance:26,path:"1"},{distance:137,path:"2"},{distance:100,path:"3"}],[{distance:64,path:"0"},{distance:3,path:"1"},{distance:27,path:"1"},{distance:138,path:"2"},{distance:101,path:"3"}],[{distance:65,path:"0"},{distance:4,path:"1"},{distance:28,path:"1"},{distance:139,path:"2"},{distance:102,path:"3"}],[{distance:66,path:"0"},{distance:5,path:"1"},{distance:29,path:"1"},{distance:140,path:"2"},{distance:103,path:"3"}],[{distance:67,path:"0"},{distance:6,path:"1"},{distance:30,path:"1"},{distance:141,path:"2"},{distance:104,path:"3"}],[{distance:68,path:"0"},{distance:7,path:"1"},{distance:31,path:"1"},{distance:142,path:"2"},{distance:105,path:"3"}],[{distance:45,path:"0"},{distance:69,path:"0"},{distance:8,path:"1"},{distance:32,path:"1"},{distance:119,path:"2"},{distance:143,path:"2"},{distance:82,path:"3"},{distance:106,path:"3"}],[{distance:70,path:"0"},{distance:33,path:"1"},{distance:144,path:"2"},{distance:107,path:"3"}],[{distance:71,path:"0"},{distance:34,path:"1"},{distance:145,path:"2"},{distance:108,path:"3"}],[{distance:72,path:"0"},{distance:35,path:"1"},{distance:146,path:"2"},{distance:109,path:"3"}],[{distance:73,path:"0"},{distance:36,path:"1"},{distance:147,path:"2"},{distance:110,path:"3"}],[{distance:74,path:"0"},{distance:37,path:"1"},{distance:148,path:"2"},{distance:111,path:"3"}],[{distance:75,path:"0"},{distance:38,path:"1"},{distance:149,path:"2"},{distance:112,path:"3"}],[{distance:76,path:"0"},{distance:39,path:"1"},{distance:150,path:"2"},{distance:113,path:"3"}],[{distance:77,path:"0"},{distance:40,path:"1"},{distance:114,path:"3"}],[{distance:78,path:"0"},{distance:41,path:"1"},{distance:115,path:"3"}],[{distance:79,path:"0"},{distance:42,path:"1"},{distance:116,path:"3"}],[{distance:80,path:"0"},{distance:43,path:"1"},{distance:117,path:"3"}],[{distance:81,path:"0"},{distance:44,path:"1"},{distance:118,path:"3"}],[{distance:82,path:"0"},{distance:106,path:"0"},{distance:45,path:"1"},{distance:69,path:"1"},{distance:8,path:"2"},{distance:32,path:"2"},{distance:119,path:"3"},{distance:143,path:"3"}],[{distance:83,path:"0"},{distance:46,path:"1"},{distance:9,path:"2"},{distance:120,path:"3"}],[{distance:84,path:"0"},{distance:47,path:"1"},{distance:10,path:"2"},{distance:121,path:"3"}],[{distance:85,path:"0"},{distance:48,path:"1"},{distance:11,path:"2"},{distance:122,path:"3"}],[{distance:86,path:"0"},{distance:49,path:"1"},{distance:12,path:"2"},{distance:123,path:"3"}],[{distance:87,path:"0"},{distance:50,path:"1"},{distance:13,path:"2"},{distance:124,path:"3"}],[{distance:88,path:"0"},{distance:51,path:"1"},{distance:14,path:"2"},{distance:125,path:"3"}],"?","?"],["?","?",[{distance:62,path:"0"},{distance:25,path:"1"},{distance:136,path:"2"},{distance:99,path:"3"}],"?","?","?","?","?",[{distance:46,path:"0"},{distance:9,path:"1"},{distance:120,path:"2"},{distance:83,path:"3"}],"?","?","?","?","?","?","?","?","?","?","?","?",[{distance:105,path:"0"},{distance:68,path:"1"},{distance:7,path:"2"},{distance:31,path:"2"},{distance:142,path:"3"}],"?","?","?","?","?",[{distance:89,path:"0"},{distance:52,path:"1"},{distance:15,path:"2"},{distance:126,path:"3"}],"?","?"],["?","?",[{distance:61,path:"0"},{distance:24,path:"1"},{distance:135,path:"2"},{distance:98,path:"3"}],"?","?","?","?","?",[{distance:47,path:"0"},{distance:10,path:"1"},{distance:121,path:"2"},{distance:84,path:"3"}],"?","?","?","?","?","?","?","?","?","?","?","?",[{distance:104,path:"0"},{distance:67,path:"1"},{distance:6,path:"2"},{distance:30,path:"2"},{distance:141,path:"3"}],"?","?","?","?","?",[{distance:90,path:"0"},{distance:53,path:"1"},{distance:16,path:"2"},{distance:127,path:"3"}],"?","?"],["?","?",[{distance:60,path:"0"},{distance:23,path:"1"},{distance:134,path:"2"},{distance:97,path:"3"}],"?","?","?","?","?",[{distance:48,path:"0"},{distance:11,path:"1"},{distance:122,path:"2"},{distance:85,path:"3"}],"?","?","?","?","?","?","?","?","?","?","?","?",[{distance:103,path:"0"},{distance:66,path:"1"},{distance:5,path:"2"},{distance:29,path:"2"},{distance:140,path:"3"}],"?","?","?","?","?",[{distance:91,path:"0"},{distance:54,path:"1"},{distance:17,path:"2"},{distance:128,path:"3"}],"?","?"],["?","?",[{distance:59,path:"0"},{distance:22,path:"1"},{distance:133,path:"2"},{distance:96,path:"3"}],"?","?","?","?","?",[{distance:49,path:"0"},{distance:12,path:"1"},{distance:123,path:"2"},{distance:86,path:"3"}],"?","?","?","?","?","?","?","?","?","?","?","?",[{distance:102,path:"0"},{distance:65,path:"1"},{distance:4,path:"2"},{distance:28,path:"2"},{distance:139,path:"3"}],"?","?","?","?","?",[{distance:92,path:"0"},{distance:55,path:"1"},{distance:18,path:"2"},{distance:129,path:"3"}],"?","?"],["?","?",[{distance:58,path:"0"},{distance:21,path:"1"},{distance:132,path:"2"},{distance:95,path:"3"}],"?","?","?","?","?",[{distance:50,path:"0"},{distance:13,path:"1"},{distance:124,path:"2"},{distance:87,path:"3"}],"?","?","?","?","?","?","?","?","?","?","?","?",[{distance:101,path:"0"},{distance:64,path:"1"},{distance:3,path:"2"},{distance:27,path:"2"},{distance:138,path:"3"}],"?","?","?","?","?",[{distance:93,path:"0"},{distance:56,path:"1"},{distance:19,path:"2"},{distance:130,path:"3"}],"?","?"],["?","?",[{distance:57,path:"0"},{distance:20,path:"1"},{distance:131,path:"2"},{distance:94,path:"3"}],[{distance:56,path:"0"},{distance:19,path:"1"},{distance:130,path:"2"},{distance:93,path:"3"}],[{distance:55,path:"0"},{distance:18,path:"1"},{distance:129,path:"2"},{distance:92,path:"3"}],[{distance:54,path:"0"},{distance:17,path:"1"},{distance:128,path:"2"},{distance:91,path:"3"}],[{distance:53,path:"0"},{distance:16,path:"1"},{distance:127,path:"2"},{distance:90,path:"3"}],[{distance:52,path:"0"},{distance:15,path:"1"},{distance:126,path:"2"},{distance:89,path:"3"}],[{distance:51,path:"0"},{distance:14,path:"1"},{distance:125,path:"2"},{distance:88,path:"3"}],"?","?","?","?","?","?","?","?","?","?","?","?",[{distance:100,path:"0"},{distance:63,path:"1"},{distance:2,path:"2"},{distance:26,path:"2"},{distance:137,path:"3"}],[{distance:99,path:"0"},{distance:62,path:"1"},{distance:25,path:"2"},{distance:136,path:"3"}],[{distance:98,path:"0"},{distance:61,path:"1"},{distance:24,path:"2"},{distance:135,path:"3"}],[{distance:97,path:"0"},{distance:60,path:"1"},{distance:23,path:"2"},{distance:134,path:"3"}],[{distance:96,path:"0"},{distance:59,path:"1"},{distance:22,path:"2"},{distance:133,path:"3"}],[{distance:95,path:"0"},{distance:58,path:"1"},{distance:21,path:"2"},{distance:132,path:"3"}],[{distance:94,path:"0"},{distance:57,path:"1"},{distance:20,path:"2"},{distance:131,path:"3"}],"?","?"],["?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?",[{distance:1,path:"2"}],"?","?","?","?","?","?","?","?"],["?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?",[{distance:0,path:"2"}],"?","?","?","?","?","?","?","?"]],Gt=[["?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?"],["?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?"],["?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?"],["?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?"],["?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?"],[[{distance:0,path:"0"}],[{distance:1,path:"0"}],[{distance:2,path:"0"}],[{distance:3,path:"0"}],[{distance:4,path:"0"}],[{distance:5,path:"0"}],[{distance:6,path:"0"}],[{distance:7,path:"0"}],[{distance:8,path:"0"}],[{distance:9,path:"0"}],[{distance:10,path:"0"}],[{distance:11,path:"0"}],[{distance:12,path:"0"}],[{distance:13,path:"0"}],[{distance:14,path:"0"}],[{distance:15,path:"0"}],[{distance:16,path:"0"}],[{distance:17,path:"0"},{distance:38,path:"2"}],[{distance:39,path:"2"}],[{distance:40,path:"2"}],[{distance:41,path:"2"}],[{distance:42,path:"2"}],[{distance:43,path:"2"}],[{distance:44,path:"2"}],[{distance:45,path:"2"}],[{distance:46,path:"2"}],[{distance:47,path:"2"}],[{distance:48,path:"2"}],[{distance:49,path:"2"}],[{distance:50,path:"2"}],[{distance:51,path:"2"}],[{distance:52,path:"2"}],[{distance:53,path:"2"}],[{distance:54,path:"2"}],[{distance:55,path:"2"}],[{distance:56,path:"2"}],[{distance:57,path:"2"}],[{distance:58,path:"2"}],[{distance:59,path:"2"}],"?","?","?","?","?","?","?","?","?"],["?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?",[{distance:18,path:"0"},{distance:37,path:"2"}],"?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?",[{distance:60,path:"2"}],"?","?","?","?","?","?","?","?","?"],["?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?",[{distance:19,path:"0"},{distance:36,path:"2"}],"?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?",[{distance:61,path:"2"}],"?","?","?","?","?","?","?","?","?"],["?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?",[{distance:20,path:"0"},{distance:35,path:"2"}],"?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?",[{distance:62,path:"2"}],"?","?","?","?","?","?","?","?","?"],["?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?",[{distance:21,path:"0"},{distance:34,path:"2"}],"?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?",[{distance:63,path:"2"}],"?","?","?","?","?","?","?","?","?"],["?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?",[{distance:22,path:"0"},{distance:33,path:"2"}],"?","?","?","?",[{distance:28,path:"1"}],[{distance:29,path:"1"}],[{distance:30,path:"1"}],[{distance:31,path:"1"}],[{distance:32,path:"1"}],[{distance:33,path:"1"}],[{distance:34,path:"1"}],"?","?","?","?","?",[{distance:60,path:"1"}],[{distance:61,path:"1"}],[{distance:62,path:"1"}],[{distance:63,path:"1"}],[{distance:64,path:"2"}],"?","?","?","?","?","?","?","?","?"],["?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?",[{distance:23,path:"0"},{distance:32,path:"2"}],"?","?","?","?",[{distance:27,path:"1"}],"?","?","?","?","?",[{distance:35,path:"1"}],"?","?","?","?","?",[{distance:59,path:"1"}],"?","?",[{distance:64,path:"1"}],[{distance:65,path:"2"}],"?","?","?","?","?","?","?","?","?"],["?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?",[{distance:24,path:"0"},{distance:31,path:"2"}],"?","?","?","?",[{distance:26,path:"1"}],"?","?","?","?","?",[{distance:36,path:"1"}],"?","?","?","?","?",[{distance:58,path:"1"}],"?","?",[{distance:65,path:"1"}],[{distance:66,path:"2"}],"?","?","?","?","?","?","?","?","?"],["?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?",[{distance:25,path:"0"},{distance:30,path:"2"}],"?","?","?","?",[{distance:25,path:"1"}],"?","?","?","?","?",[{distance:37,path:"1"}],"?","?","?","?","?",[{distance:57,path:"1"}],"?","?",[{distance:66,path:"1"}],[{distance:67,path:"2"}],"?","?","?","?","?","?","?","?","?"],["?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?",[{distance:26,path:"0"},{distance:29,path:"2"}],"?","?","?","?",[{distance:24,path:"1"}],"?","?","?","?","?",[{distance:38,path:"1"}],"?","?","?","?","?",[{distance:56,path:"1"}],"?","?",[{distance:67,path:"1"}],[{distance:68,path:"2"}],"?","?","?","?","?","?","?","?","?"],["?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?",[{distance:27,path:"0"},{distance:28,path:"2"}],"?","?","?","?",[{distance:23,path:"1"}],"?","?","?","?","?",[{distance:39,path:"1"}],"?","?","?","?","?",[{distance:55,path:"1"}],"?","?",[{distance:68,path:"1"}],[{distance:69,path:"2"}],"?","?","?","?","?","?","?","?","?"],[[{distance:0,path:"1"}],[{distance:1,path:"1"}],[{distance:2,path:"1"}],[{distance:3,path:"1"}],[{distance:4,path:"1"}],[{distance:5,path:"1"}],[{distance:6,path:"1"}],[{distance:7,path:"1"}],[{distance:8,path:"1"}],[{distance:9,path:"1"}],[{distance:10,path:"1"}],[{distance:11,path:"1"}],[{distance:12,path:"1"}],[{distance:13,path:"1"}],[{distance:14,path:"1"}],[{distance:15,path:"1"}],[{distance:16,path:"1"}],[{distance:28,path:"0"},{distance:17,path:"1"},{distance:27,path:"2"}],[{distance:18,path:"1"}],[{distance:19,path:"1"}],[{distance:20,path:"1"}],[{distance:21,path:"1"}],[{distance:22,path:"1"}],"?","?","?","?","?",[{distance:40,path:"1"}],"?","?","?","?","?",[{distance:54,path:"1"}],"?","?",[{distance:69,path:"1"}],[{distance:69,path:"0"},{distance:70,path:"1"},{distance:70,path:"2"}],[{distance:70,path:"0"},{distance:71,path:"1"},{distance:71,path:"2"}],[{distance:71,path:"0"},{distance:72,path:"1"},{distance:72,path:"2"}],[{distance:72,path:"0"},{distance:73,path:"1"},{distance:73,path:"2"}],[{distance:73,path:"0"},{distance:74,path:"1"},{distance:74,path:"2"}],[{distance:74,path:"0"},{distance:75,path:"1"},{distance:75,path:"2"}],[{distance:75,path:"0"},{distance:76,path:"1"},{distance:76,path:"2"}],[{distance:76,path:"0"},{distance:77,path:"1"},{distance:77,path:"2"}],[{distance:77,path:"0"},{distance:78,path:"1"},{distance:78,path:"2"}],"?"],["?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?",[{distance:29,path:"0"},{distance:26,path:"2"}],"?","?","?","?","?","?","?","?","?","?",[{distance:41,path:"1"}],"?","?","?","?","?",[{distance:53,path:"1"}],"?","?","?",[{distance:68,path:"0"}],"?","?","?","?","?","?","?","?","?"],["?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?",[{distance:30,path:"0"},{distance:25,path:"2"}],"?","?","?","?","?","?","?","?","?","?",[{distance:42,path:"1"}],"?","?","?","?","?",[{distance:52,path:"1"}],"?","?","?",[{distance:67,path:"0"}],"?","?","?","?","?","?","?","?","?"],["?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?",[{distance:31,path:"0"},{distance:24,path:"2"}],"?","?","?","?","?","?","?","?","?","?",[{distance:43,path:"1"}],"?","?","?","?","?",[{distance:51,path:"1"}],"?","?","?",[{distance:66,path:"0"}],"?","?","?","?","?","?","?","?","?"],["?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?",[{distance:32,path:"0"},{distance:23,path:"2"}],"?","?","?","?","?","?","?","?","?","?",[{distance:44,path:"1"}],[{distance:45,path:"1"}],[{distance:46,path:"1"}],[{distance:47,path:"1"}],[{distance:48,path:"1"}],[{distance:49,path:"1"}],[{distance:50,path:"1"}],"?","?","?",[{distance:65,path:"0"}],"?","?","?","?","?","?","?","?","?"],["?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?",[{distance:33,path:"0"},{distance:22,path:"2"}],"?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?",[{distance:64,path:"0"}],"?","?","?","?","?","?","?","?","?"],["?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?",[{distance:34,path:"0"},{distance:21,path:"2"}],"?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?",[{distance:63,path:"0"}],"?","?","?","?","?","?","?","?","?"],["?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?",[{distance:35,path:"0"},{distance:20,path:"2"}],"?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?",[{distance:62,path:"0"}],"?","?","?","?","?","?","?","?","?"],["?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?",[{distance:36,path:"0"},{distance:19,path:"2"}],"?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?",[{distance:61,path:"0"}],"?","?","?","?","?","?","?","?","?"],["?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?",[{distance:37,path:"0"},{distance:18,path:"2"}],"?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?",[{distance:60,path:"0"}],"?","?","?","?","?","?","?","?","?"],[[{distance:0,path:"2"}],[{distance:1,path:"2"}],[{distance:2,path:"2"}],[{distance:3,path:"2"}],[{distance:4,path:"2"}],[{distance:5,path:"2"}],[{distance:6,path:"2"}],[{distance:7,path:"2"}],[{distance:8,path:"2"}],[{distance:9,path:"2"}],[{distance:10,path:"2"}],[{distance:11,path:"2"}],[{distance:12,path:"2"}],[{distance:13,path:"2"}],[{distance:14,path:"2"}],[{distance:15,path:"2"}],[{distance:16,path:"2"}],[{distance:38,path:"0"},{distance:17,path:"2"}],[{distance:39,path:"0"}],[{distance:40,path:"0"}],[{distance:41,path:"0"}],[{distance:42,path:"0"}],[{distance:43,path:"0"}],[{distance:44,path:"0"}],[{distance:45,path:"0"}],[{distance:46,path:"0"}],[{distance:47,path:"0"}],[{distance:48,path:"0"}],[{distance:49,path:"0"}],[{distance:50,path:"0"}],[{distance:51,path:"0"}],[{distance:52,path:"0"}],[{distance:53,path:"0"}],[{distance:54,path:"0"}],[{distance:55,path:"0"}],[{distance:56,path:"0"}],[{distance:57,path:"0"}],[{distance:58,path:"0"}],[{distance:59,path:"0"}],"?","?","?","?","?","?","?","?","?"],["?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?"],["?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?"],["?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?"],["?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?"],["?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?","?"]],Q=h=>{let a=1;return h>2&&(a+=(h-2)*.1),h>40&&(a+=(h-40)*.1),Math.min(a,10)},E=h=>h%10===0,H=h=>E(h)?1:Math.min(20+(h-1),60),et=h=>{let s=0;for(let i=0;i<h;i+=1)s+=50*(i*2),s+=Math.pow(i,1.5+Math.floor(i/50)/2);return E(h)&&(s*=H(h-1)/2.5),Math.floor(100+s)},Kt=h=>E(h)?Math.floor(1e3*(h/10)):Math.floor(10+h*2+Math.pow(h,1.25));var P,j,G,K;class Vt extends q{constructor({game:t,position:s,width:i,height:n,texts:d,buttons:r}){super();c(this,"game");m(this,P);m(this,j);m(this,G);m(this,K);c(this,"buttons");this.game=t,g(this,P,s),g(this,j,i),g(this,G,n),g(this,K,d),this.buttons=r}draw(){var i;const{ctx:t}=this.game;t.fillStyle="#000",t.fillRect(p(this,P).x,p(this,P).y,p(this,j),p(this,G)),t.fillStyle="#fff",t.font="16px Arial",t.textAlign="center",t.textBaseline="middle";let s=p(this,P).y+20;p(this,K).forEach(n=>{t.fillText(n,p(this,P).x+p(this,j)/2,s),s+=20}),(i=this.buttons)==null||i.forEach(n=>n.draw())}}P=new WeakMap,j=new WeakMap,G=new WeakMap,K=new WeakMap;var f,k,z,V,_;class _t extends q{constructor({game:t,position:s,width:i,height:n,text:d,onClick:r}){super();c(this,"game");m(this,f);m(this,k);m(this,z);m(this,V);m(this,_);this.game=t,g(this,f,s),g(this,k,i),g(this,z,n),g(this,V,d),g(this,_,r)}draw(){const{ctx:t}=this.game;t.fillStyle="#fff",t.fillRect(p(this,f).x,p(this,f).y,p(this,k),p(this,z)),t.fillStyle="green",t.fillRect(p(this,f).x+2,p(this,f).y+2,p(this,k)-4,p(this,z)-4),t.fillStyle="#000",t.font="14px Arial",t.textAlign="center",t.textBaseline="middle",t.fillText(p(this,V),p(this,f).x+p(this,k)/2,p(this,f).y+p(this,z)/2)}isClicked(t){return t.x>=p(this,f).x&&t.x<=p(this,f).x+p(this,k)&&t.y>=p(this,f).y&&t.y<=p(this,f).y+p(this,z)}handleClick(t){return this.isClicked(t)?(p(this,_).call(this),!0):!1}}f=new WeakMap,k=new WeakMap,z=new WeakMap,V=new WeakMap,_=new WeakMap;const Z=h=>h<1e3?h.toString():h<1e6?Number((h/1e3).toFixed(1))+"K":h<1e9?Number((h/1e6).toFixed(1))+"M":h<1e12?Number((h/1e9).toFixed(1))+"B":Number((h/1e12).toFixed(1))+"T",y=(h,a)=>{const t=Date.now();a();const i=Date.now()-t;i>5&&console.log(`${h} took ${i}ms`)};var v,F,O,b,Y,W;class Yt{constructor(){m(this,v,10);m(this,F,100);m(this,O,0);c(this,"debug",!1);c(this,"canvas");c(this,"ctx");c(this,"squareSize",50);c(this,"gridWidth",25);c(this,"gridHeight",25);c(this,"level");c(this,"mouseHandler");c(this,"hoveredCell",null);c(this,"images",{});c(this,"tempCounter",-1);c(this,"projectiles",[]);m(this,b,null);m(this,Y,null);m(this,W,!1);c(this,"gameSpeed",1e3);c(this,"backgroundImage",null);c(this,"completedWaves",{});c(this,"damageLog",{max:0});c(this,"dialogs",[]);c(this,"lastRenderTime",Date.now());this.canvas=document.createElement("canvas");const a=this.canvas.getContext("2d");if(!a)throw new Error("2d context not supported");if(this.ctx=a,Math.random()>.75)this.gridHeight=30,this.gridWidth=30,this.level=new J({game:this,endPositions:[{col:14,row:15}],startPositions:[{col:8,row:0},{col:21,row:0},{col:29,row:21},{col:8,row:29}],maxLength:200,maxRepeatSquares:1,minLength:100,map:Ut});else if(Math.random()>.75)this.gridHeight=48,this.gridWidth=32,this.level=new J({game:this,endPositions:[{col:16,row:47}],startPositions:[{col:5,row:0},{col:16,row:0},{col:26,row:0}],maxLength:100,maxRepeatSquares:1,minLength:60,map:Gt});else if(Math.random()>.75)this.gridHeight=20,this.gridWidth=20,this.level=new J({game:this,endPositions:[{col:8,row:10}],startPositions:[{col:0,row:1}],maxLength:200,maxRepeatSquares:1,minLength:100,map:$t});else{let s=[];do s.push({col:Math.floor((Math.random()+.5)*this.gridHeight/2),row:Math.floor((Math.random()+.5)*this.gridWidth/2)});while(Math.random()>.85&&s.length<4);this.level=new J({game:this,endPositions:[{col:Math.floor(Math.random()*this.gridHeight/2),row:Math.floor(Math.random()*this.gridWidth/2)}],startPositions:s,maxLength:250,maxRepeatSquares:3,minLength:100})}g(this,v,10*this.level.startPositions.length),this.money=100+50*(this.level.startPositions.length-1),this.canvas.width=this.squareSize*this.gridWidth,this.canvas.height=this.squareSize*this.gridHeight,document.body.appendChild(this.canvas),this.mouseHandler=new Bt(this),this.loadImages(),new URLSearchParams(window.location.search).has("debug")&&(this.debug=!0,this.level.wave=Number(prompt("Wave to start from","1"))-1,this.money=Number(prompt("Money","100")),window.getMonsterHealth=et,window.getMonsterSpeed=Q,window.getNumberOfMonstersPerWave=H,window.isBossWave=E),It(this)}canStartWave(){return p(this,v)>0&&(this.tempCounter===H(this.level.wave)||this.tempCounter===-1)}startWave(){this.canStartWave()&&(this.level.wave++,this.tempCounter=0,console.log(`Starting ${E(this.level.wave)?"boss wave":"wave"} ${this.level.wave}. ${H(this.level.wave)} monsters with ${et(this.level.wave).toLocaleString("en-US")} health and ${Q(this.level.wave)} speed`),this.spawnMonsters())}spawnMonsters(){setTimeout(()=>{this.tempCounter<H(this.level.wave)&&(this.level.startPositions.forEach((a,t)=>{this.spawnMonster(`${t}`)}),this.tempCounter++,this.spawnMonsters())},this.gameSpeed/2/Q(this.level.wave))}spawnMonster(a){const t=E(this.level.wave)?Ot:D;let s;this.level.wave<=10?s="plant":this.level.wave<=20?s="skeleton":this.level.wave<=30?s="orcWarrior":this.level.wave<=40?s="fireSpirit":s=dt[Math.floor(Math.random()*dt.length)],this.level.monsters.push(new t({game:this,health:et(this.level.wave),speed:Q(this.level.wave),damage:E(this.level.wave)?5:1,reward:Kt(this.level.wave),type:s,path:a})),ct(this.level.monsters.length)}loadImages(){Nt.forEach(a=>{const t=new Image;t.src=`./assets/${a}.png`,this.images[a]=t})}update(){y("update game",()=>{var s;if(p(this,W))return;const a=this.level.monsters.filter(i=>i.distance>=this.level.mapMatrix.totalDistances[i.path]),t=this.level.monsters.filter(i=>!i.isAlive());t.forEach(i=>{this.money+=i.reward,this.killCount++}),this.level.monsters=this.level.monsters.filter(i=>i.isAlive()&&i.distance<this.level.mapMatrix.totalDistances[i.path]).sort((i,n)=>n.distance-i.distance),a.forEach(i=>{console.log(`Monster reached the end, -${i.damage} health`),this.health-=i.damage}),y("update monsters",()=>{this.level.monsters.forEach(i=>{i.update()})}),y("update towers",()=>{this.level.towers.forEach(i=>{i.update()})}),y("update projectiles",()=>{this.projectiles.forEach(i=>{i.update()})}),p(this,v)<0&&confirm("Game Over! Play again?")&&window.location.reload(),(t.length>0||a.length>0)&&ct(this.level.monsters.length),this.canStartWave()&&this.level.monsters.length===0&&this.completedWaves[this.level.wave]!==!0&&(this.completedWaves[this.level.wave]=!0,console.log(`Wave ${this.level.wave} completed!`),console.log("*** DAMAGE LOG ***"),Object.keys(this.damageLog).forEach(n=>{console.log(`${n}: ${Math.round(this.damageLog[n]).toLocaleString()}`)}),(s=document.getElementById("automode"))!=null&&s.checked&&this.startWave())})}render(){y("render game",()=>{const a=Date.now();try{if(y("draw grid",()=>{this.drawGrid()}),y("draw monsters",()=>{this.level.monsters.forEach(s=>{s.render()})}),y("draw towers",()=>{this.level.towers.forEach(s=>{s.render()})}),y("draw projectiles",()=>{this.projectiles.forEach(s=>{s.render()})}),p(this,v)<=0&&(this.ctx.save(),this.ctx.fillStyle="red",this.ctx.font="30px Arial",this.ctx.textAlign="center",this.ctx.fillText("Game Over!",this.canvas.width/2,this.canvas.height/1.5),this.ctx.restore()),p(this,b)&&this.hoveredCell&&(this.ctx.save(),this.ctx.globalAlpha=.25,this.ctx.beginPath(),this.ctx.arc(this.hoveredCell.col*this.squareSize+this.squareSize/2,this.hoveredCell.row*this.squareSize+this.squareSize/2,p(this,b).range*this.squareSize,0,2*Math.PI),this.ctx.fillStyle="purple",this.ctx.globalAlpha=.5,p(this,b).gridPosition=this.hoveredCell,p(this,b).render(),this.ctx.fill(),this.ctx.restore()),this.selectedTower){const{col:s,row:i}=this.selectedTower.gridPosition;this.ctx.save(),this.ctx.globalAlpha=.25,this.ctx.beginPath(),this.ctx.arc(s*this.squareSize+this.squareSize/2,i*this.squareSize+this.squareSize/2,this.selectedTower.range*this.squareSize,0,2*Math.PI),this.ctx.fillStyle="blue",this.ctx.globalAlpha=.35,this.ctx.fill(),this.ctx.restore();let n=0;this.ctx.save(),this.ctx.fillStyle="black",this.ctx.fillRect(this.canvas.width-200,n,200,140),n+=20,this.ctx.fillStyle="white",this.ctx.font="16px Arial",this.ctx.textAlign="center",this.ctx.fillText(`${this.selectedTower.type} tower`,this.canvas.width-100,n),n+=20,this.ctx.textAlign="left",this.ctx.fillText("Damage: ",this.canvas.width-180,n),this.ctx.textAlign="right",this.ctx.fillText(Z(this.selectedTower.damage),this.canvas.width-20,n),n+=20,this.ctx.textAlign="left",this.ctx.fillText("Speed: ",this.canvas.width-180,n),this.ctx.textAlign="right",this.ctx.fillText(this.selectedTower.attackSpeed.toLocaleString("en-US"),this.canvas.width-20,n),n+=20,this.ctx.textAlign="left",this.ctx.fillText("DPS: ",this.canvas.width-180,n),this.ctx.textAlign="right",this.ctx.fillText(Z(this.selectedTower.damage*this.selectedTower.attackSpeed),this.canvas.width-20,n),n+=20,this.ctx.textAlign="left",this.ctx.fillText("Range: ",this.canvas.width-180,n),this.ctx.textAlign="right",this.ctx.fillText(Math.round(this.selectedTower.range).toLocaleString("en-US"),this.canvas.width-20,n),n+=20,this.ctx.textAlign="left",this.ctx.fillText("Splash: ",this.canvas.width-180,n),this.ctx.textAlign="right",this.ctx.fillText(this.selectedTower.splash?this.selectedTower.splash.toLocaleString("en-US"):"❌",this.canvas.width-20,n),this.ctx.restore()}this.dialogs.forEach(s=>s.draw())}catch(s){console.error(s),this.debug&&alert(`Error rendering game: ${s}`)}const t=Date.now();this.debug&&(this.ctx.save(),this.ctx.fillStyle="black",this.ctx.font="10px Arial",this.ctx.fillText(`FPS: ${Math.round(1e3/(t-this.lastRenderTime))}`,10,10),this.ctx.restore(),t-a>5&&console.log(`Render time: ${t-a}ms`)),this.lastRenderTime=t})}drawGrid(){if(!this.backgroundImage){const a=document.createElement("canvas");a.width=this.canvas.width,a.height=this.canvas.height;const t=a.getContext("2d");if(!t)throw new Error("2d context not supported");t.clearRect(0,0,a.width,a.height);const{matrix:s}=this.level.mapMatrix;Object.keys(s).forEach(i=>{const n=Number(i);Object.keys(s[n]).forEach(d=>{const r=Number(d),o=s[n][r];t.save(),typeof o=="string"?o===A?t.fillStyle="blue":o===M?t.fillStyle="rgba(255, 0, 0, 0.5)":t.fillStyle="green":Array.isArray(o)&&o.some(l=>l.distance===0)?t.fillStyle="blue":Array.isArray(o)&&o.length>0&&(t.fillStyle="rgb(200, 200, 200)"),t.fillRect(n*this.squareSize,r*this.squareSize,this.squareSize,this.squareSize),this.debug&&(t.save(),t.fillStyle="black",t.font="10px Arial",Array.isArray(o)&&o.length>0?t.fillText(`${o.map(l=>l.path+"-"+l.distance).join(", ")}`,n*this.squareSize+5,r*this.squareSize+15):o===A?t.fillText(A,n*this.squareSize+5,r*this.squareSize+15):o===M&&t.fillText(M,n*this.squareSize+5,r*this.squareSize+15),t.font="10px Arial",t.fillText(`${n},${r}`,n*this.squareSize+20,r*this.squareSize+40),t.restore()),t.strokeStyle="lightgray",t.strokeRect(n*this.squareSize,r*this.squareSize,this.squareSize,this.squareSize),t.restore()})}),this.backgroundImage=a}this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.drawImage(this.backgroundImage,0,0),this.hoveredCell&&(this.ctx.save(),this.ctx.strokeStyle="gold",this.ctx.lineWidth=3,this.ctx.strokeRect(this.hoveredCell.col*this.squareSize,this.hoveredCell.row*this.squareSize,this.squareSize,this.squareSize),this.ctx.restore())}convertGridPositionToCoordinates(a){return{x:a.col*this.squareSize+this.squareSize/2,y:a.row*this.squareSize+this.squareSize/2}}upgradeTower(a){this.money>=tt(a)&&(this.money-=tt(a),a.level++,this.selectedTower=a)}get health(){return p(this,v)}set health(a){g(this,v,a),Rt(p(this,v))}get money(){return p(this,F)}set money(a){g(this,F,a),Ft(p(this,F))}get killCount(){return p(this,O)}set killCount(a){g(this,O,a),jt(p(this,O))}get newTower(){var a;return((a=p(this,b))==null?void 0:a.type)||null}set newTower(a){g(this,b,a?new mt[a](this,this.hoveredCell,"basic"):null)}get selectedTower(){return p(this,Y)}set selectedTower(a){if(g(this,Y,a),this.dialogs=[],a){const t=a.getCanvasPosition(),s=200,i=200;t.x-=s/2,t.y>this.canvas.height/2?t.y-=i:t.y+=this.squareSize,t.x=Math.max(0,t.x),t.x=Math.min(this.canvas.width-s,t.x),t.y=Math.max(0,t.y),t.y=Math.min(this.canvas.height-i,t.y);const n=tt(a),d=new _t({game:this,text:`${n.toLocaleString("en-US")}🪙 Upgrade`,position:{...t,x:t.x+25,y:t.y+125},onClick:()=>this.upgradeTower(a),height:50,width:150}),{level:r}=a,o=r+1;this.dialogs.push(new Vt({game:this,height:i,width:s,position:t,texts:[`Level ${r} -> ${o}`,`Damage: ${Z(Number(x(a.type,"damage",r)))} -> ${Z(Number(x(a.type,"damage",o)))}`,`Speed: ${x(a.type,"attackSpeed",r)} -> ${x(a.type,"attackSpeed",o)}`,`Range: ${x(a.type,"range",r)} -> ${x(a.type,"range",o)}`,`Splash: ${x(a.type,"splash",r)} -> ${x(a.type,"splash",o)}`],buttons:[d]}))}}get paused(){return p(this,W)}set paused(a){const t=Date.now();this.level.towers.forEach(s=>{s.lastAttackTime=t}),this.level.monsters.forEach(s=>{s.lastUpdateTime=t}),this.projectiles.forEach(s=>{s.lastMoveTime=t}),g(this,W,a)}}v=new WeakMap,F=new WeakMap,O=new WeakMap,b=new WeakMap,Y=new WeakMap,W=new WeakMap;class Xt{constructor(a){c(this,"mousePosition");c(this,"mapBuilder");c(this,"pressedKeys",[]);this.mousePosition={x:0,y:0},this.mapBuilder=a,this.init()}getCellAtMousePosition(){const{x:a,y:t}=this.mousePosition,{squareSize:s}=this.mapBuilder,i=Math.floor(a/s);return{row:Math.floor(t/s),col:i}}init(){this.mapBuilder.canvas.addEventListener("mousemove",a=>{const t=this.mapBuilder.canvas.getBoundingClientRect();this.mousePosition={x:a.clientX-t.left,y:a.clientY-t.top},this.mapBuilder.hoveredCell=this.getCellAtMousePosition()}),this.mapBuilder.canvas.addEventListener("click",()=>{this.handleClick()}),this.mapBuilder.canvas.addEventListener("contextmenu",a=>{a.preventDefault();const t=this.getCellAtMousePosition();this.mapBuilder.mapMatrix[t.col][t.row]="?"}),this.mapBuilder.canvas.addEventListener("wheel",a=>{a.deltaY<0?this.mapBuilder.currentDistance+=1:(this.mapBuilder.currentDistance-=1,this.mapBuilder.currentDistance<0&&(this.mapBuilder.currentDistance=0)),this.mapBuilder.canvas.width=this.mapBuilder.width*this.mapBuilder.squareSize,this.mapBuilder.canvas.height=this.mapBuilder.height*this.mapBuilder.squareSize,this.mapBuilder.render()}),document.addEventListener("keydown",a=>{this.pressedKeys.push(a.key),a.key==="s"&&this.pressedKeys.includes("Control")&&(a.preventDefault(),console.log(JSON.stringify(this.mapBuilder.mapMatrix)))}),document.addEventListener("keyup",a=>{this.pressedKeys=this.pressedKeys.filter(t=>t!==a.key)})}handleClick(){if(this.pressedKeys.includes("Shift")){this.mapBuilder.currentPath=Number(this.mapBuilder.currentPath)+1+"";return}if(this.pressedKeys.includes("Control")){this.mapBuilder.currentPath=Math.max(1,Number(this.mapBuilder.currentPath))-1+"";return}const a=this.getCellAtMousePosition(),t=this.mapBuilder.mapMatrix[a.col][a.row];typeof t=="string"?this.mapBuilder.mapMatrix[a.col][a.row]=[{distance:this.mapBuilder.currentDistance,path:this.mapBuilder.currentPath}]:t.push({distance:this.mapBuilder.currentDistance,path:this.mapBuilder.currentPath}),this.mapBuilder.currentDistance+=1}}class Jt{constructor(a,t){c(this,"squareSize",32);c(this,"canvas");c(this,"ctx");c(this,"mouseHandler");c(this,"mapMatrix");c(this,"hoveredCell",null);c(this,"debug",!0);c(this,"width");c(this,"height");c(this,"currentPath","0");c(this,"currentDistance",0);this.width=a,this.height=t,this.canvas=document.createElement("canvas"),this.canvas.width=a*this.squareSize,this.canvas.height=t*this.squareSize,this.ctx=this.canvas.getContext("2d"),this.mapMatrix={},this.initMapMatrix(),this.mouseHandler=new Xt(this),document.body.appendChild(this.canvas)}render(){this.drawGrid()}initMapMatrix(){this.mapMatrix=Array.from({length:this.width},()=>Array(this.height).fill(e))}drawGrid(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),Object.keys(this.mapMatrix).forEach(s=>{const i=Number(s);Object.keys(this.mapMatrix[i]).forEach(n=>{const d=Number(n),r=this.mapMatrix[i][d];this.ctx.save(),typeof r=="string"?r===A?this.ctx.fillStyle="blue":r===M?this.ctx.fillStyle="rgba(255, 0, 0, 0.5)":r===e?this.ctx.fillStyle="green":this.ctx.fillStyle="green":Array.isArray(r)&&r.some(o=>o.distance===0)?this.ctx.fillStyle="blue":Array.isArray(r)&&r.length>0&&(this.ctx.fillStyle="rgb(200, 200, 200)"),this.ctx.fillRect(i*this.squareSize,d*this.squareSize,this.squareSize,this.squareSize),this.debug&&(this.ctx.save(),this.ctx.fillStyle="black",this.ctx.font="10px Arial",Array.isArray(r)&&r.length>0?this.ctx.fillText(`${r.map(o=>o.path+"-"+o.distance).join(", ")}`,i*this.squareSize+5,d*this.squareSize+15):r===A?this.ctx.fillText(A,i*this.squareSize+5,d*this.squareSize+15):r===M&&this.ctx.fillText(M,i*this.squareSize+5,d*this.squareSize+15),this.ctx.fillStyle="black",this.ctx.font="8px Arial",this.ctx.fillText(`${i},${d}`,i*this.squareSize+10,d*this.squareSize+25),this.ctx.restore()),this.ctx.strokeStyle="lightgray",this.ctx.strokeRect(i*this.squareSize,d*this.squareSize,this.squareSize,this.squareSize),this.ctx.restore()})}),this.ctx.save(),this.ctx.strokeStyle="orange",this.ctx.lineWidth=3,this.ctx.beginPath();const a={};Object.keys(this.mapMatrix).forEach(s=>{const i=Number(s);Object.keys(this.mapMatrix[i]).forEach(n=>{const d=Number(n),r=this.mapMatrix[i][d];Array.isArray(r)&&r.forEach(o=>{o.path===this.currentPath&&(a[o.distance]={row:d,col:i})})})});let t=0;if(a[t])for(this.ctx.moveTo(a[t].col*this.squareSize+this.squareSize/2,a[t].row*this.squareSize+this.squareSize/2),t+=1;a[t];)this.ctx.lineTo(a[t].col*this.squareSize+this.squareSize/2,a[t].row*this.squareSize+this.squareSize/2),t+=1;this.ctx.stroke(),this.ctx.restore(),this.hoveredCell&&(this.ctx.save(),this.ctx.strokeStyle="gold",this.ctx.lineWidth=3,this.ctx.strokeRect(this.hoveredCell.col*this.squareSize,this.hoveredCell.row*this.squareSize,this.squareSize,this.squareSize),this.ctx.fillStyle="black",this.ctx.font="20px Arial",this.ctx.fillText(`${this.currentPath}-${this.currentDistance}`,this.hoveredCell.col*this.squareSize+5,this.hoveredCell.row*this.squareSize+20),this.ctx.restore())}}const Qt=()=>{var i,n;const h=Number((i=prompt("Enter the width of map (e.g. 15):"))==null?void 0:i.replace(/\D/g,"")),a=Number((n=prompt("Enter the height of map (e.g. 15):"))==null?void 0:n.replace(/\D/g,"")),t=new Jt(h,a),s=async()=>{t.render(),requestAnimationFrame(s)};s()},Zt=new URLSearchParams(window.location.search).get("builder");if(Zt)Qt();else{const h=new Yt,a=async()=>{h.render(),requestAnimationFrame(a)},t=async()=>{h.update(),h.health>=0&&setTimeout(t,1e3/240)};a(),t(),document.addEventListener("visibilitychange",()=>{document.hidden?h.paused=!0:h.paused=!1})}
